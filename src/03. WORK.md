# WORK

## -----10/08/2025-----

### FIREBASE AUTHENTICATION

- dando nome utente e password, firebase authentication invia un token JWT relativo all'utente
- il token JWT non è mai lo stesso, ogni certo periodo di tempo cambia. Quando accade, occorre richiedere una nuova login all'utente.
- firebase controlla da solo se la sessione è ancora valida oppure no. Io NON devo fare nessun controllo (ES: salvare il token JWT sul db e confrontarlo). Alla scadenza, sarà chiamato automaticamente onAuthStateChanged. In questo metodo, occorre far tornare l'utente alla schermata di login

### COME DIRE AI PRODOTTI QUALE E' L'UTENTE AUTENTICATO

Lo si può fare in diversi modi:

- passare il token JWT ricevuto nel querystring del prodtto. In questo modo il prodotto lo può decodificare e sapere quali prodotti ottenere. NOTA: NON è sicuro farlo perchè chi dovesse intercettare la url, avrebbe accesso al prodotto !
- SSO: dopo la login nel mio progetto, il prodotto che si apre chiede al BE/DB quale utente è loggato; quando lo saprà, potra configurarsi propriamente per l'utente appena loggato

### FIREBASE REALTIME DATABASE

Il real time database permette l'esecuzione di query basilari sui dati, come:

- .orderByChild("nomeCampo") // Ordina per un campo specifico
- .orderByKey() // Ordina per chiave del nodo
- .orderByValue() // Ordina per valore del nodo (solo se è un valore semplice)
- .equalTo("valore") // Filtra per valore esatto
- .startAt("valore") // Filtra per valori maggiori o uguali
- .endAt("valore") // Filtra per valori minori o uguali
- .limitToFirst(10) // Limita ai primi N risultati
- .limitToLast(10) // Limita agli ultimi N risultati

### PROBLEMA - PROGETTO INIZIALE NON VALIDO

#### Problema iniziale:

- Hai più prodotti (es. SportTracker, GameScopa) che devono autenticare utenti e mantenere dati separati.
- Ogni prodotto è un progetto Firebase diverso (o ospitato separatamente).
- Vuoi un’autenticazione unica (SSO) per tutti i prodotti.
- Hai vincoli su numero di progetti Firebase (max 5 per account Google personale).
- Vuoi evitare backend complessi e mantenere tutto client-side.
- Il progetto SportTracker usa il piano Blaze (a pagamento) e vuoi evitare confusione tra progetti e costi.

#### Soluzione

- Creare un unico progetto Firebase centralizzato per autenticazione (Auth) e Realtime Database condiviso.
- Organizzare il database in questo modo:
  - Nodo users con chiavi uguali agli UID Firebase degli utenti.
  - Sotto ogni utente, un nodo products con i dati separati per ogni prodotto (es. sportTracker, gameScopa).
  - il database sarà creato secondo il seguente modello.
    MODELLO: {"sharedLogin":{},"users":{"uid_aaa":{"products":{"sportTracker":{...firebaseData},"gameScopa":{...firebaseData}}},"uid_bbb":{"products":{"sportTracker":{...firebaseData},"gameScopa":{...firebaseData}}}}}

### TODO - DESIGN BE CON FIREBASE

- NON voglio usare firebase functions per evitare costi extra. Posso fare affidamento solo sul real time database
- devo implementare la login con firebase authentication inviando le credenziali e ricevendo il token JWT relativo all'utente
- QUINDI:
  - creare nuoa email generica da usare per firebase auth (per evitare di avere problemi in futuro siccome il mio account principale non ha GB)
    - <ameapps@gmail.com>
  - chiudere blaze in firebase per sport monitoring
  - implementare passaggio token JWT nel querystring
  - permettere modifica prodotto
  - implemento servizio login
  - inserire li il metodo per la login e quello per il controllo dello stato della sessione (un componente verrebbe chiuso, il servizio no)


### REGOLE FIREBASE REALTIME DB - SICURE
{
  "rules": {
    "sharedLogin": {
      ".read": "auth != null",
      ".write": "root.child('admins').child(auth.uid).exists()"
    },
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid"
      }
    }
  }
}

### REGOLE NON SICURE

{
  "rules": {
    ".read": true,
    ".write": true
  }
}


## -----28/08/2025-----

### TODO 

- [ok] mostrare icona maschio/femmina in modo corretto, prelevando i dati utente da firebase 
- fare in modo che se l'utente è già loggato e torna indietro dopo essere entrato nella pagina dei prodotti, non deve poter tornare alla login (non serve perchè è già loggato)
- implementare componenti per l'aggiunta / eliminazione / modifica utente 
- valutare implementazione dashboard 
- implementare aggiunta utente
- implementare aggiunta prodotto 